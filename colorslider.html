<!DOCTYPE html>
<html>
<head>
<style type="text/css">
 
.bar{
	width:200px;
	height:25px;
	border:1px solid black;
	position:relative;
}
 
.slider{
	width:0%;
	height:100%;
	top:0px;
	left:0px;
	position:absolute;
	cursor:pointer;
}
 
.info{
	width:200px;
	height:25px;
	border:1px solid black;	
}
 
</style>


<script type="text/javascript" src="glMatrix-0.9.5.min.js"></script>

<script id="shader-fs" type="x-shader/x-fragment">
   precision mediump float;

    varying vec4 vColor;

    void main(void) {
        gl_FragColor = vColor;
    }
</script>

<script id="shader-vs" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec4 aVertexColor;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;

    varying vec4 vColor;

    void main(void) {
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
        vColor = aVertexColor;
    }
</script>

<script type="text/javascript" src="colorwebgl.js"></script>


<script type="text/javascript">

function init() {
	
	initSlide('Red');
	initSlide('Green');
	initSlide('Blue');
	
	infoBright = document.getElementById('Brightinfo');

	displaybox = document.getElementById('displaybox')

	infoAGR = document.getElementById('agr')
	infoABY = document.getElementById('aby')
	infoAWB = document.getElementById('awb')

	// Startup for WebGL, found in the other script @ colorwebgl.js.
	initWebGL();

}

function initSlide(str) {

	// Initializes a bar, a slider, and an info for a given string.
	// Expects a "bar" with id str, a "slider" which is inside the bar with id str+"slider",
	// and an "info" with id str+"info".
	bar = document.getElementById(str);
	slider = document.getElementById(str+'slider');
	info = document.getElementById(str+'info');

	// If you click on a slider bar, it should start sliding. If you let go of the mouse
	// or drag your cursor out of the slider bar, it should stop sliding.
	bar.addEventListener('mousedown', startSlide, false);	
	bar.addEventListener('mouseup', stopSlide, false);	
	bar.addEventListener('mouseleave', stopSlide, false)
	// This was a good idea, but actually caused a lot of problems. bar.addEventListener('mouseout', stopSlide, false);

}	
 
function startSlide(event){
	var bar = event.currentTarget;

	// When you start sliding, we want to watch for further motion on the slider bar to keep updating.
	bar.addEventListener('mousemove', moveSlide, false);	

	// Actually move the slider.
	moveSlide(event);
}

function stopSlide(event){
	var bar = event.currentTarget;

	// When you stop sliding, we need to remove the listener for motion along the slider bar.
	bar.removeEventListener('mousemove', moveSlide, false);

	// Actually move the slider.
	// No! Don't do that. moveSlide(event);
}

function moveSlide(event){

	// The bar that got clicked on is the event's current target
	var bar = event.currentTarget;

	// The slider inside the bar has the same id except with 'slider' tacked on
	var slider = document.getElementById(event.currentTarget.id + 'slider')

	// The display information has the same id except with 'info' tacked on
	var info = document.getElementById(event.currentTarget.id + 'info')

	// Here is the percent full that it should become
	var set_perc = ((((event.clientX - bar.offsetLeft) / bar.offsetWidth)).toFixed(2));

	//Set the slider to the correct size.
	slider.style.width = (set_perc * 100) + '%';

	// Call the function that makes the box the correct color.
	updateColor();

}

function setColor(r,g,b) {


	sliderRed = document.getElementById('Redslider');
	sliderGreen = document.getElementById('Greenslider');
	sliderBlue = document.getElementById('Blueslider');

	sliderRed.style.width = r + '%';
	sliderGreen.style.width = g + '%';
	sliderBlue.style.width = b + '%';

	updateColor();
}
 
function updateColor(){

	barRed = document.getElementById('Red');
	sliderRed = document.getElementById('Redslider');
	infoRed = document.getElementById('Redinfo');
	barGreen = document.getElementById('Green');
	sliderGreen = document.getElementById('Greenslider');
	infoGreen = document.getElementById('Greeninfo');
	barBlue = document.getElementById('Blue');
	sliderBlue = document.getElementById('Blueslider');
	infoBlue = document.getElementById('Blueinfo');
	

	// The percentage that each bar is full
	var perc_r = sliderRed.offsetWidth / barRed.offsetWidth;
	var perc_g = sliderGreen.offsetWidth / barGreen.offsetWidth;
	var perc_b = sliderBlue.offsetWidth / barBlue.offsetWidth;

	// Convert it from a scale of 0 to 0.99 to a scale from -1 to 1
	// (Such a conversion is a line with slope 200/99 and intercept -1)
	var value_r = -1 + perc_r*200/99;
	var value_g = -1 + perc_g*200/99;
	var value_b = -1 + perc_b*200/99;
	var value_bright = (value_r + value_g + value_b)/3

	// Do the matrix transformation that makes color vision work
	var value_agr = (value_r - value_g)/2;
	var value_aby = (value_r + value_g)/4 - value_b / 2;
	var value_awb = value_bright;

	// Display the end result of the color info.
	infoRed.innerHTML = 'Red : ' + (value_r).toFixed(2);
	infoGreen.innerHTML = 'Green : ' + (value_g).toFixed(2);
	infoBlue.innerHTML = 'Blue : ' + (value_b).toFixed(2);
	infoBright.innerHTML = 'Bright : ' + (value_bright).toFixed(2);
	infoAGR.innerHTML = 'A(G/R) : ' + (value_agr).toFixed(2);
	infoABY.innerHTML = 'A(B/Y) : ' + (value_aby).toFixed(2);
	infoAWB.innerHTML = 'A(W/B) : ' + (value_awb).toFixed(2);
	infoBright.innerHTML = 'Bright: ' + (value_bright).toFixed(2);

	// Grab the value for R, G, and B from 0 to 256. Convert to hex with .toString(16)
	var color_r = (Math.floor(perc_r * 256)).toString(16);
	var color_g = (Math.floor(perc_g * 256)).toString(16);
	var color_b = (Math.floor(perc_b * 256)).toString(16);

	// Pad small hex numbers with zeroes.
	color_r = "00".substr(0, 2 - color_r.length) + color_r;	
	color_g = "00".substr(0, 2 - color_g.length) + color_g;	
	color_b = "00".substr(0, 2 - color_b.length) + color_b;	

	// Now we have a color.
	color = '#' + color_r + color_g + color_b;
	
	// Set the display to that color.
	displaybox.style.backgroundColor = color;

	// Try to interact with webGL.
	gl.bindBuffer(gl.ARRAY_BUFFER, squareVertexColorBuffer);
    colors = []
    for (var i=0; i < 4; i++) {
      //colors = colors.concat([0.5, 0.5, 1.0, 1.0]);
      colors = colors.concat([perc_r, perc_g, perc_b, 1.0]);
    }
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(colors), gl.STATIC_DRAW);
    drawScene();

}

</script>
 
</head>
<body onload='init()'>
 
<div id='Red' class='bar'><div id='Redslider' class='slider' style='background-color:red; width:50%'></div></div>
<div id='Green' class='bar'><div id='Greenslider' class='slider' style='background-color:green; width:50%'></div></div>
<div id='Blue' class='bar'><div id='Blueslider' class='slider' style='background-color:blue; width:50%'></div></div>

<br />
 

<table>
<tr>
<td valign='top'>
	<div id='Redinfo' class='info'>Red: 0</div> 
	<div id='Greeninfo' class='info'>Green: 0</div> 
	<div id='Blueinfo' class='info'>Blue: 0</div>
	<div id='Brightinfo' class='info'>Bright: 0</div>
</td>
<td valign='top'>
	<div id='agr' class='info'> A(G/R) = 0</div>
	<div id='aby' class='info'> A(B/Y) = 0</div>
	<div id='awb' class='info'> A(W/B) = -1</div>
</td>
<td valign='top'>
	<center><b>Basic Presets</b><br>
	<input type='button' style='width:80px' value='Black' onClick='setColor(0,0,0)'><br>
	<input type='button' style='width:80px' value='Gray' onClick='setColor(50,50,50)'><br>
	<input type='button' style='width:80px' value='White' onClick='setColor(100,100,100)'><br>
</td>
<td valign='top'>
	<center><b>Tricky Yellow</b><br>
	<input type='button' style='width:80px' value='Start' onClick='setColor(0,0,100)'><br>
	<input type='button' style='width:80px' value='End' onClick='setColor(50,50,50)'><br>
	<br>
</td>
<td valign='top'>
	<center><b>Stygian Blue</b><br>
	<input type='button' style='width:80px' value='Start' onClick='setColor(100,100,0)'><br>
	<input type='button' style='width:80px' value='End' onClick='setColor(0,0,0)'><br>
	<br>
</td>
</tr>
</table>
 
<br />

<table width="1000"><tr><td>

	<table id='displaybox' style='height:500px; width:500px; background-color:#888888'> 
	<tr><td align='center' valign='center'>
		<div id='circle' style='height:350px; width:350px; background-color:#888888; -webkit-border-radius: 100%; -moz-border-radius: 100%; border-radius: 100%; display:table-cell; vertical-align: middle;'>X</div>
	</td></tr></table>

</td>
<td>

  <canvas id="glcanvas" width="500" height="500">
    Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
  </canvas>

</td></tr></table>

</body>
</html>
